homeassistant:
  # Name of the location where Home Assistant is running
  name: Home
  # Location required to calculate the time the sun rises and sets
  latitude: 40.6829446
  longitude: -73.4518569
  # Impacts weather/sunrise data (altitude above sea level in meters)
  elevation: 6
  # metric for Metric, imperial for Imperial
  unit_system: imperial
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: America/New_York
  # Customization file
  customize: !include customize.yaml

influxdb:
  host: 127.0.0.1
  username: home-assistant
  password: hapass
  database: home_assistant
  include:
    entities:
      - binary_sensor.entrance_motion
      - sensor.living_room_thermostat_temperature
      - binary_sensor.front_door
      - climate.wine_room_temp
      - climate.fin_temps
      - sensor.wine_iscooling
      - sensor.wine_isdefrosting
      - sensor.upstairs_thermostat_temperature
      - binary_sensor.family_motion
      - binary_sensor.basement_motion
      - switch.leviton_vrs151lz_binary_scene_switch_switch
      - switch.leviton_vrs151lz_binary_scene_switch_switch_2
      - light.leviton_vri061lx_multilevel_scene_switch_level
      - switch.fireplace_switch
      - sensor.current_solar_power
      - sensor.wine_room_humidity
      - sensor.disk_used_

# Enables the frontend
frontend:

# Enables configuration UI
config:

http:
  # Secrets are defined in the file secrets.yaml
  api_password: !secret http_password
  # Uncomment this if you are using SSL/TLS, running in Docker container, etc.
  base_url: frank.apsquared.co:8123

# Checks for available updates
# Note: This component will send some information about your system to
# the developers to assist with development of Home Assistant.
# For more information, please see:
# https://home-assistant.io/blog/2016/10/25/explaining-the-updater/
updater:
  # Optional, allows Home Assistant developers to focus on popular components.
  # include_used_components: true

# Discover some devices automatically
discovery:
  ignore:
    - plex_mediaserver
    - samsung_tv

# Allows you to issue voice commands from the frontend in enabled browsers
conversation:

# Enables support for tracking state changes over time
history:

recorder:
  purge_interval: 1
  purge_keep_days: 5
  include: 
    domains:
      - sensor
      - switch
      - binary_sensor
      - climate
      - lock
      - light
  exclude:
    entities:
     - sensor.last_boot
     - sensor.date
     - sensor.wine_cooling_since
     - sensor.pws_weather_1d
     - sensor.pws_weather_1n
     - sensor.pws_weather_2d
     - sensor.pws_weather_2n
     - sensor.pws_weather_3d
     - sensor.pws_weather_3n
     - sensor.pws_weather_4d
     - sensor.pws_weather_4n
     - sensor.entrancemd_tripped
     - sensor.familymd_tripped
     - sensor.frontdoor_tripped

logbook:

# Enables a map showing the location of tracked devices
map:

# Track the sun
sun:

binary_sensor:
  - platform: ping
    host: pizero1
  - platform: template
    sensors:
      wine_connected:
        friendly_name: "Wine Room Connected"
        device_class: connectivity
        value_template: "{{ ((as_timestamp(now())-as_timestamp(states.sensor.wine_room_humidity.last_updated)))|float < 60 }}"

sensor:
  - platform: bitcoin
    display_options:
      - exchangerate
  - platform: yr
  - platform: dnsip
    name: "MyIP"
  - platform: mqtt
    state_topic: "ha/wine/Humidity"
    name: "Wine Room Humidity"
    unit_of_measurement: "%"
    value_template: '{{ value }}'
  - platform: rest
    resource: https://api.enphaseenergy.com/api/v2/systems/585444/summary?key=b99f94ecb36851197a00d112579d9769&user_id=4e6a4d7a4e4459340a
    value_template: '{{ value_json.current_power }}'
    scan_interval: 300 
    name: "Current Solar Power"
  - platform: systemmonitor
    resources:
      - type: disk_use_percent
        arg: /
      - type: memory_free
      - type: processor_use
      - type: since_last_boot
  - platform: wunderground
    api_key: !secret wunderground_key
    monitored_conditions:
      - weather_1d
      - weather_1n
      - weather_2d
      - weather_2n
      - weather_3d
      - weather_3n
      - weather_4d
      - weather_4n
  - platform: template
    sensors:
      entrancemd_tripped:
        value_template: '{{ ((as_timestamp(now())-as_timestamp(states.binary_sensor.entrance_motion.last_changed))/60) | round (0)}}'
      familymd_tripped:
        value_template: '{{ ((as_timestamp(now())-as_timestamp(states.binary_sensor.family_motion.last_changed))/60) | round (0)}}'
      basementmd_tripped:
        value_template: '{{ ((as_timestamp(now())-as_timestamp(states.binary_sensor.basement_motion.last_changed))/60) | round (0)}}'
      frontdoor_tripped:
        value_template: '{{ ((as_timestamp(now())-as_timestamp(states.binary_sensor.front_door.last_changed))/60) | round (0)}}'
      wine_iscooling:
        value_template: '{% if is_state("climate.wine_room_temp", "Cooling") -%}1{%- else -%}0{%- endif %}'
      wine_cooling_since:
        value_template: '{% if is_state("wine_iscooling", "1")  -%}{{ ((as_timestamp(now())-as_timestamp(states.sensor.wine_iscooling.last_updated))/60) | round (0)}}{%- else -%}0{%- endif %}'
      wine_isdefrosting:
        value_template: '{% if is_state("climate.fin_temps", "Defrosting") -%}1{%- else -%}0{%- endif %}'
      zwave_front_door_battery:
        value_template: '{{ states.zwave.schlage_be469nxcen_touchscreen_deadbolt.attributes.battery_level|default(0) }}'
        icon_template: >
          {% set battery_level = states.zwave.schlage_be469nxcen_touchscreen_deadbolt.attributes.battery_level | default(0) | int %}
          {% set battery_round = (battery_level / 10) |int * 10 %}
          {% if battery_round >= 100 %}
            mdi:battery
          {% elif battery_round > 0 %}
            mdi:battery-{{ battery_round }}
          {% else %}
            mdi:battery-alert
          {% endif %}
        
switch:
  - platform: mqtt
    name: "Fireplace Switch"
    state_topic: "ha/fireplace"
    command_topic: "myhome/fireplace"
    payload_on: "1"
    payload_off: "0"
    optimistic: false

# Text to speech
tts:
  - platform: google

mqtt:
    broker: pizero1
    

zwave:
    usb_path: /dev/ttyACM0
    network_key: "0x45, 0xF9, 0x78, 0x9E, 0x0D, 0x4C, 0x29, 0x88, 0x21, 0x9C, 0xF2, 0xA5, 0xC4, 0xDD, 0xF6, 0xDB"
    device_config:
      light.leviton_vri061lx_multilevel_scene_switch_level:
        polling_intensity: 3
        refresh_value: true
      switch.leviton_vrs151lz_binary_scene_switch_switch:
        polling_intensity: 2
      switch.leviton_vrs151lz_binary_scene_switch_switch_2:
        polling_intensity: 2      
      lock.schlage_be469nxcen_touchscreen_deadbolt_locked:
        polling_intensity: 5
      lock.kwikset_touchpad_electronic_deadbolt_locked:
        polling_intensity: 5
        
climate:
  - platform: mqtt
    initial: 58
    name: "Wine Room Temp"
    temperature_command_topic: "myhome/wine/setdesiredtemp"
    temperature_state_topic: "ha/wine/DesiredTemp"
    current_temperature_topic: "ha/wine/Room Temp"
    mode_state_topic: "ha/wine/Cooling" 
    modes:
      - "Cooling"
      - "Off"
    swing_modes:
    fan_modes:
  - platform: mqtt
    initial: 32
    target_temp_low: 0 
    name: "Fin Temps"
    temperature_command_topic: "myhome/wine/setfinmintemp"
    temperature_state_topic: "ha/wine/finMinTemp"
    current_temperature_topic: "ha/wine/Fin Temp"
    mode_state_topic: "ha/wine/Defrosting" 
    modes:
      - "Defrosting"
      - "Normal"
    swing_modes:
    fan_modes:

amcrest:
  - host: 192.168.1.17
    username: admin
    password: !secret basement_cam_pwd
    stream_source: rtsp
    resolution: low
    sensors:
      - motion_detector

camera:
  - platform: mjpeg
    ip: 192.168.1.20
    mjpeg_url: !secret outside_cam_url
  - platform: mjpeg 
    ip: 192.168.1.11
    username: guest
    password: !secret porchcam_password
    mjpeg_url: http://192.168.1.11/videostream.cgi?user=guest&pwd=guest
  - platform: generic
    still_image_url: 'https://icons.wxug.com/data/weather-maps/radar/united-states/binghamton-new-york-region-current-radar-animation.gif'
    name: WU Doppler Weather
#  - platform: generic
#    still_image_url: 'http://pizero1:3000/dashboard-solo/db/hass-dash?refresh=30s&panelId=1&orgId=1&theme=light&width=600&height=400&tz=UTC-05%3A00'
#    name: Recent Wine Temps

weblink:
  entities:
    - name: Grafana
      url: https://frank.apsquared.co:3000/dashboard/db/hass-dash?refresh=30s&orgId=1&theme=light
      icon: mdi:chart-bar
nest:
  client_id: dd64a10b-ade6-4b83-9cc2-ed302d9ac7ca
  client_secret: Ydo15n8gGoSnUEWtxbmKuBTWN

envisalink:
  host: 192.168.1.22
  panel_type: DSC
  user_name: user
  password: user
  code: '0429'
  port: 4025
  evl_version: 3
  keepalive_interval: 60
  zonedump_interval: 30
  panic_type: Police
  zones:
    1:
      name: 'Front Door'
      type: 'opening'
    2:
      name: 'Sliding Door'
      type: 'opening'
    4:
      name: 'Back Door'
      type: 'opening'
    5:
      name: 'Basement Door'
      type: 'opening'
    6:
      name: 'Family Motion'
      type: 'motion'
    7:
      name: 'Entrance Motion'
      type: 'motion'
    15:
      name: 'Basement Motion'
      type: 'motion'
  partitions:
    1:
      name: 'Home Alarm'

device_tracker:
  - platform: owntracks_http
    max_gps_accuracy: 300

input_boolean:
  enable_front_door_autolock:
    name: Enable Front Door AutoLock
    initial: on
    icon: mdi:lock

#vera:
#  vera_controller_url: http://192.168.1.4:3480/
  # Optional to exclude devices - this is a list of vera device ids
#  exclude: [ 76, 28, 85,23]
  # Optional to import switches as lights - this is a list of vera device ids
#  lights: [3,34,35]

panel_iframe:
  configurator:
    title: Configurator
    icon: mdi:wrench
    url: http://frank.apsquared.co:3218

zone:
  - name: Home
    latitude: 40.6829446
    longitude: -73.4518569
    radius: 100
    icon: mdi:account-multiple

group: !include groups.yaml
automation: !include automations.yaml
script: !include scripts.yaml
